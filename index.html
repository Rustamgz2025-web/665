<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargo 665 | Bilingual Logistics Calculator | 货运计算器</title>
    <style>
        :root {
            --primary: #1a1a1a;
            --accent: #f39c12;
            --accent-hover: #e67e22;
            --bg-body: #f1f2f6;
            --bg-card: #ffffff;
            --text-main: #2c3e50;
            --text-light: #7f8c8d;
            --border-color: #dcdde1;
            --success: #27ae60;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
            --radius: 16px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", sans-serif;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.5;
            padding-bottom: 50px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Banner Styling */
        header {
            background: var(--primary);
            width: 100%;
            margin-bottom: 40px;
            border-bottom: 4px solid var(--accent);
            position: relative;
            overflow: hidden;
        }

        .banner-wrapper {
            width: 100%;
            max-height: 400px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary);
        }

        .banner-image {
            width: 100%;
            height: auto;
            display: block;
            object-fit: cover;
            object-position: center;
        }

        @media (max-width: 1400px) { .banner-wrapper { max-height: 350px; } }
        @media (max-width: 992px) { .banner-wrapper { max-height: 300px; } }
        @media (max-width: 768px) { .banner-wrapper { max-height: 200px; } }
        @media (max-width: 480px) { .banner-wrapper { max-height: 150px; } }

        /* Helpers */
        .cn {
            display: block;
            font-size: 0.85em;
            font-weight: 400;
            color: var(--accent);
            margin-top: 2px;
        }

        /* Layout */
        .app-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        @media (max-width: 992px) { .app-grid { grid-template-columns: 1fr; } }

        .card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 35px;
            box-shadow: var(--shadow);
        }

        h2 {
            margin-bottom: 30px;
            font-size: 1.5rem;
            border-left: 5px solid var(--accent);
            padding-left: 15px;
        }

        /* Forms */
        .form-group { margin-bottom: 25px; }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            font-size: 0.95rem;
        }

        .input-box {
            position: relative;
            display: flex;
            align-items: center;
        }

        input, select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #edf2f7;
            border-radius: 12px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        input:focus, select:focus {
            border-color: var(--accent);
            background: white;
            box-shadow: 0 0 0 4px rgba(243, 156, 18, 0.1);
        }

        .unit {
            position: absolute;
            right: 18px;
            font-weight: 600;
            color: var(--text-light);
            pointer-events: none;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Result Panel */
        .result-panel {
            background: var(--primary);
            color: white;
            position: sticky;
            top: 30px;
            display: flex;
            flex-direction: column;
        }

        .total-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .total-amount {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 25px;
            color: #fff;
        }

        .breakdown {
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 25px;
        }

        .row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.95rem;
        }

        .row .val {
            font-weight: 700;
            color: var(--accent);
        }

        .row .lbl {
            color: #bdc3c7;
        }

        .btn-print {
            background: var(--accent);
            color: var(--primary);
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s, background 0.3s;
            text-transform: uppercase;
        }

        .btn-print:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        /* Checkboxes */
        .checkbox-card {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .check-item {
            border: 2px solid #edf2f7;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: 0.2s;
        }

        .check-item:hover { border-color: var(--accent); }
        .check-item input { width: auto; }

        /* Insurance Section Styles */
        .ins-hidden { display: none; }
        
        .ins-info-box {
            margin-top: 15px;
            border: 1px solid #dcdde1;
            border-radius: 8px;
            overflow: hidden;
            font-size: 0.85rem;
        }
        
        .ins-info-box summary {
            background: #f8fafc;
            padding: 10px 15px;
            cursor: pointer;
            font-weight: 600;
            list-style: none; /* Hide default triangle */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .ins-info-box summary::after {
            content: "+";
            font-size: 1.2rem;
            color: var(--accent);
        }
        
        .ins-info-box[open] summary::after {
            content: "-";
        }
        
        .ins-content {
            padding: 15px;
            background: white;
            color: var(--text-main);
            line-height: 1.6;
        }

        .ins-content ul { padding-left: 20px; margin-bottom: 10px; }
        .ins-content li { margin-bottom: 5px; }
        .important-red { color: #e74c3c; font-weight: bold; }

        /* Tables */
        .table-section { margin-top: 50px; }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        th {
            background: #f8fafc;
            padding: 15px;
            text-align: left;
            font-size: 0.85rem;
            color: var(--text-light);
            text-transform: uppercase;
        }
        td {
            padding: 15px;
            border-top: 1px solid #f1f2f6;
        }
        tr.active-row {
            background: rgba(243, 156, 18, 0.1);
            font-weight: 700;
        }

        /* Print */
        #print-offer { display: none; }
        @media print {
            body * { visibility: hidden; }
            #print-offer, #print-offer * { visibility: visible; }
            #print-offer {
                display: block;
                position: absolute;
                left: 0; top: 0; width: 100%;
                background: white; color: black; padding: 40px;
            }
            .no-print { display: none !important; }
            .print-logo { height: 80px; margin-bottom: 10px; }
        }
        .print-head {
            display: flex;
            justify-content: space-between;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>

<header class="no-print">
    <div class="banner-wrapper">
        <img src="66501.jpg" alt="Cargo 665 Banner" class="banner-image">
    </div>
</header>

<main class="container">
    <div class="app-grid no-print">
        <!-- Form Column -->
        <div class="card">
            <h2>
                Калькулятор стоимости
                <span class="cn">费用计算器</span>
            </h2>

            <div class="form-group">
                <label>Категория товаров / 货物类别</label>
                <select id="category" onchange="calc()">
                    <option value="house">Хозтовары / 日用品 (30-35 d)</option>
                    <option value="cloth">Одежда / 服装 (30-35 d)</option>
                    <option value="shoes">Обувь / 鞋类 (10-15 d)</option>
                    <option value="express">Спецгруз / Авиа-экспресс / 特殊货物 (8-12 d)</option>
                    <option value="taobao">Taobao / 淘宝 (25-40 d)</option>
                </select>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label>Вес / 重量</label>
                    <div class="input-box">
                        <input type="number" id="weight" value="10" min="10" step="0.1" oninput="calc()">
                        <span class="unit">kg</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>Объем / 体积</label>
                    <div class="input-box">
                        <input type="number" id="volume" value="0.1" step="0.01" oninput="calc()">
                        <span class="unit">m³</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Дополнительно / 额外费用</label>
                <div class="checkbox-card">
                    <label class="check-item">
                        <input type="checkbox" id="spec_cargo" onchange="calc()">
                        <span>Электроника/Текстиль <span class="cn">电子/纺织 (+$0.2)</span></span>
                    </label>
                    <label class="check-item">
                        <input type="checkbox" id="replica" onchange="calc()">
                        <span>Реплики брендов <span class="cn">仿牌 (+$0.3)</span></span>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label>Упаковка / 包装类型 (Обязательно)</label>
                <select id="pack" onchange="calc()">
                    <option value="4" selected>Мешок + Скотч / 袋子 + 胶带 ($4)</option>
                    <option value="5">Уголки / 护角包裝 ($5)</option>
                    <option value="8">Обрешетка / 木架 ($8)</option>
                    <option value="30">Поддон / 托盘 ($30/m³)</option>
                </select>
            </div>

            <!-- New Insurance Section -->
            <div class="form-group">
                <label>Страхование груза / 货物保险</label>
                <div style="margin-bottom: 15px;">
                    <label class="check-item" style="width: 100%;">
                        <input type="checkbox" id="ins_check" onchange="toggleInsurance()">
                        <span>Застраховать груз <span class="cn">购买保险</span></span>
                    </label>
                </div>

                <div id="ins_input_block" class="ins-hidden">
                    <label style="font-size: 0.9em; margin-bottom: 5px;">Общая стоимость товара ($) / 货物总值</label>
                    <div class="input-box">
                        <input type="number" id="val_goods" placeholder="Например: 700" oninput="calc()">
                        <span class="unit">$</span>
                    </div>
                    <div style="margin-top: 5px; font-size: 0.85rem; color: var(--accent);">
                        Расчетный тариф: <span id="ins_percent_display">0%</span>
                    </div>
                </div>

                <!-- Accordion for Legal Text -->
                <details class="ins-info-box">
                    <summary>Условия страхования и ответственность</summary>
                    <div class="ins-content">
                        <p><b>СБОР СТРАХОВАНИЯ ТОВАРА: от 1-7% от общей суммы товара</b></p>
                        <br>
                        <p>1. Страхование является добровольным (рекомендуем для товаров >500$).</p>
                        <p>2. Возмещение только за <b>потерянный/украденный/конфискованный</b> груз.</p>
                        <p>3. Ответственность: доставка до г. Москва МКАД 19.</p>
                        <br>
                        <p class="important-red">ВАЖНО:</p>
                        <p>Мы не несем ответственность за повреждение или утрату товарного вида в пути. (См. раздел упаковки).</p>
                        <p>Обязательно сверяйте вес груза при получении!</p>
                        <br>
                        <p><b>Страховой сбор (Обычный):</b></p>
                        <ul>
                            <li>1% - стоимость до 15$/кг</li>
                            <li>2% - стоимость 16-30$/кг</li>
                            <li>3% - стоимость 31-45$/кг</li>
                            <li>4% - стоимость 46-60$/кг</li>
                            <li>5% - стоимость 61-75$/кг</li>
                            <li>6% - стоимость 76-90$/кг</li>
                            <li>7% - стоимость 91-105$/кг</li>
                            <li>>105$/кг - Индивидуально</li>
                        </ul>
                        <p><b>Страховой сбор (Авиа-экспресс):</b></p>
                        <ul>
                            <li>< 200$/кг - 1%</li>
                            <li>200-400$/кг - 2%</li>
                            <li>400-600$/кг - 3%</li>
                            <li>600-800$/кг - 4%</li>
                            <li>800-1000$/кг - 5%</li>
                            <li>> 1000$/кг - 6%</li>
                        </ul>
                        <br>
                        <p><b>Без страховки:</b></p>
                        <p>При утере груза компенсация: <b>3$ за кг</b>.</p>
                        <br>
                        <p style="font-size:0.8em; color:#7f8c8d;">Если вы не предупреждаете нас о наличии брендов/запрещенных товаров, страховка не выплачивается.</p>
                    </div>
                </details>
            </div>
        </div>

        <!-- Result Column -->
        <div class="card result-panel">
            <div class="total-label">Итого к оплате / 总费用</div>
            <div class="total-amount" id="res_total">$0.00</div>

            <div class="breakdown">
                <div class="row">
                    <span class="lbl">Плотность / 密度</span>
                    <span class="val" id="res_dens">0 kg/m³</span>
                </div>
                <div class="row">
                    <span class="lbl">Тариф / 单价</span>
                    <span class="val" id="res_rate">$0.00</span>
                </div>
                <div class="row">
                    <span class="lbl">Доставка / 运费</span>
                    <span class="val" id="res_ship">$0.00</span>
                </div>
                <div class="row">
                    <span class="lbl">Упаковка / 包装</span>
                    <span class="val" id="res_pack">$0.00</span>
                </div>
                <div class="row">
                    <span class="lbl">Страховка / 保险</span>
                    <span class="val" id="res_ins">$0.00</span>
                </div>
            </div>

            <button class="btn-print" onclick="window.print()">
                Печать КП / 打印报价单
            </button>
            
            <p style="font-size: 0.7rem; color: #7f8c8d; margin-top: 15px; text-align: center;">
                *Минимальный вес 10кг. / 最低重量 10 公斤
            </p>
        </div>
    </div>

    <!-- Tables -->
    <div class="table-section no-print">
        <h2 style="margin-top: 40px;">Тарифная сетка / 价格表</h2>
        <div style="overflow-x: auto;">
            <table id="tariff_table">
                <thead>
                    <tr>
                        <th>Плотность / 密度 (kg/m³)</th>
                        <th>Цена / 价格 ($/kg)</th>
                        <th>Примечание / 备注</th>
                    </tr>
                </thead>
                <tbody id="table_body"></tbody>
            </table>
        </div>
    </div>
</main>

<!-- PRINT TEMPLATE -->
<div id="print-offer">
    <div class="print-head">
        <div>
            <img src="66501.jpg" alt="Logo" class="print-logo">
            <p>Commercial Offer / 商业报价单</p>
        </div>
        <div style="text-align: right;">
            <p>Date: <span id="p_date"></span></p>
            <p>Contacts: +7 (916) 028-12-61</p>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 30px;">
        <div>
            <h3>Cargo Details / 货物详情</h3>
            <hr style="margin: 10px 0;">
            <p>Category / 类别: <b id="p_cat"></b></p>
            <p>Weight / 重量: <b id="p_weight"></b> kg</p>
            <p>Volume / 体积: <b id="p_vol"></b> m³</p>
            <p>Density / 密度: <b id="p_dens"></b> kg/m³</p>
            <p>Cargo Value / 货值: <b id="p_goods_val"></b></p>
        </div>
        <div>
            <h3>Final Quote / 最终报价</h3>
            <hr style="margin: 10px 0;">
            <p>Shipping / 运费: <b id="p_ship"></b></p>
            <p>Packaging / 包装: <b id="p_pack"></b></p>
            <p>Insurance (<span id="p_ins_rate">0%</span>) / 保险: <b id="p_ins"></b></p>
            <h2 style="color: #f39c12; margin-top: 15px;">TOTAL: <span id="p_total"></span></h2>
        </div>
    </div>

    <div style="margin-top: 50px; background: #f9f9f9; padding: 20px; font-size: 13px;">
        <p><b>Terms / 条款:</b></p>
        <p>1. Delivery time depends on selected category. / 运输时间取决于所选类别。</p>
        <p>2. Insurance covers loss/theft only. / 保险仅承保丢失/被盗。</p>
        <p>3. Compensation without insurance: $3/kg. / 无保险赔偿：3美元/公斤。</p>
        <p>4. No compensation for hidden brands/prohibited items. / 瞒报品牌或违禁品无赔偿。</p>
    </div>
</div>

<script>
    const DATA = {
        house: [
            {m:1000, x:9999, p:1.2}, {m:800, x:1000, p:1.3}, {m:600, x:800, p:1.4},
            {m:500, x:600, p:1.5}, {m:400, x:500, p:1.6}, {m:350, x:400, p:1.7},
            {m:300, x:350, p:1.8}, {m:250, x:300, p:1.9}, {m:200, x:250, p:2.0},
            {m:100, x:200, p:2.5}, {m:0, x:100, p:300, v:true}
        ],
        cloth: [
            {m:400, x:9999, p:2.8}, {m:350, x:400, p:2.9}, {m:300, x:350, p:3.0},
            {m:250, x:300, p:3.1}, {m:200, x:250, p:3.2}, {m:100, x:200, p:3.5}
        ],
        shoes: [
            {m:200, x:250, p:2.3}, {m:150, x:200, p:2.7}, {m:100, x:150, p:3.2},
            {m:0, x:100, p:310, v:true}
        ],
        express: [
            {m:400, x:9999, p:1.7}, {m:200, x:400, p:2.1}, {m:100, x:200, p:2.8},
            {m:0, x:100, p:320, v:true}
        ],
        taobao: [
            {m:0, x:9999, p:7.0}
        ]
    };

    function toggleInsurance() {
        const isChecked = document.getElementById('ins_check').checked;
        const block = document.getElementById('ins_input_block');
        block.style.display = isChecked ? 'block' : 'none';
        if (!isChecked) {
            document.getElementById('val_goods').value = '';
        }
        calc();
    }

    function getInsuranceRate(cat, val, weight) {
        if (weight <= 0 || val <= 0) return 0;
        const valPerKg = val / weight;

        // Special logic for Express
        if (cat === 'express') {
            if (valPerKg <= 200) return 0.01;
            if (valPerKg <= 400) return 0.02;
            if (valPerKg <= 600) return 0.03;
            if (valPerKg <= 800) return 0.04;
            if (valPerKg <= 1000) return 0.05;
            return 0.06;
        }

        // Standard Logic
        if (valPerKg <= 15) return 0.01;
        if (valPerKg <= 30) return 0.02;
        if (valPerKg <= 45) return 0.03;
        if (valPerKg <= 60) return 0.04;
        if (valPerKg <= 75) return 0.05;
        if (valPerKg <= 90) return 0.06;
        if (valPerKg <= 105) return 0.07;
        
        return 0.07; // Default max for > 105 (Individual)
    }

    function calc() {
        const cat = document.getElementById('category').value;
        const w = parseFloat(document.getElementById('weight').value) || 0;
        const v = parseFloat(document.getElementById('volume').value) || 0;
        const isSpec = document.getElementById('spec_cargo').checked;
        const isRep = document.getElementById('replica').checked;
        const packVal = parseFloat(document.getElementById('pack').value);
        
        // Insurance Calc
        const isInsured = document.getElementById('ins_check').checked;
        const goodsVal = parseFloat(document.getElementById('val_goods').value) || 0;
        
        if (w < 1) return;

        // Shipping Rate
        const density = v > 0 ? w / v : 0;
        const tiers = DATA[cat];
        let tier = tiers.find(t => density >= t.m && density < t.x) || tiers[tiers.length - 1];

        let rate = tier.p;
        if (isSpec) rate += 0.2;
        if (isRep) rate += 0.3;

        const shipCost = tier.v ? (v * rate) : (w * rate);
        const packCost = packVal === 30 ? (v * 30) : packVal;

        // Insurance Cost
        let insPct = 0;
        let insCost = 0;
        if (isInsured && goodsVal > 0) {
            insPct = getInsuranceRate(cat, goodsVal, w);
            insCost = goodsVal * insPct;
        }

        const total = shipCost + packCost + insCost;

        // Update UI
        document.getElementById('res_total').innerText = '$' + total.toFixed(2);
        document.getElementById('res_dens').innerText = density.toFixed(1) + ' kg/m³';
        document.getElementById('res_rate').innerText = '$' + rate.toFixed(2) + (tier.v ? '/m³' : '/kg');
        document.getElementById('res_ship').innerText = '$' + shipCost.toFixed(2);
        document.getElementById('res_pack').innerText = '$' + packCost.toFixed(2);
        document.getElementById('res_ins').innerText = '$' + insCost.toFixed(2);
        
        // Update Insurance Display text
        const pctDisplay = (insPct * 100).toFixed(0) + '%';
        const valPerKg = w > 0 ? (goodsVal / w).toFixed(1) : 0;
        const indLabel = (cat !== 'express' && valPerKg > 105) ? ' (Индив.)' : '';
        document.getElementById('ins_percent_display').innerText = pctDisplay + indLabel;

        renderTable(cat, density);
        updatePrint(cat, w, v, density, shipCost, packCost, insCost, total, goodsVal, pctDisplay);
    }

    function renderTable(cat, currentDens) {
        const body = document.getElementById('table_body');
        body.innerHTML = '';
        DATA[cat].forEach(t => {
            const tr = document.createElement('tr');
            if (currentDens >= t.m && currentDens < t.x) tr.className = 'active-row';
            
            const range = t.x > 5000 ? `>${t.m}` : `${t.m}-${t.x}`;
            tr.innerHTML = `
                <td>${range}</td>
                <td>$${t.p}${t.v ? '/m³' : ''}</td>
                <td>${t.v ? 'Объемный тариф / 体积价格' : 'По весу / 按重量'}</td>
            `;
            body.appendChild(tr);
        });
    }

    function updatePrint(cat, w, v, d, ship, pack, ins, total, gVal, insRateTxt) {
        const names = {house:'Хозтовары / 日用品', cloth:'Одежда / 服装', shoes:'Обувь / 鞋类', express:'Спецгруз / Авиа', taobao:'Taobao'};
        document.getElementById('p_date').innerText = new Date().toLocaleDateString();
        document.getElementById('p_cat').innerText = names[cat];
        document.getElementById('p_weight').innerText = w;
        document.getElementById('p_vol').innerText = v;
        document.getElementById('p_dens').innerText = d.toFixed(1);
        document.getElementById('p_ship').innerText = '$' + ship.toFixed(2);
        document.getElementById('p_pack').innerText = '$' + pack.toFixed(2);
        document.getElementById('p_ins').innerText = '$' + ins.toFixed(2);
        document.getElementById('p_total').innerText = '$' + total.toFixed(2);
        
        // New Print Fields
        document.getElementById('p_goods_val').innerText = gVal > 0 ? '$' + gVal : 'No Insurance';
        document.getElementById('p_ins_rate').innerText = ins > 0 ? insRateTxt : '0%';
    }

    window.onload = calc;
</script>

</body>
</html>
